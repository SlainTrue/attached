<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Attached by ksylvest</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Attached</h1>
        <p>A file attachment tool that lets users upload to the cloud</p>

        <p class="view"><a href="https://github.com/ksylvest/attached">View the Project on GitHub <small>ksylvest/attached</small></a></p>


        <ul>
          <li><a href="https://github.com/ksylvest/attached/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ksylvest/attached/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ksylvest/attached">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p>= Attached</p>

<p>Attached is a Ruby on Rails file attachment tool that lets users upload to the cloud. The gem supports AWS, Google and Rackspace for storage networks by default. It is influenced (and copied) from Paperclip and makes heavy use of the incredibly awesome Fog library.</p>

<p>== Requirements</p>

<p>The gem is tested with:</p>

<ul>
<li>Ruby on Rails 4.1.1</li>
<li>Ruby on Rails 4.0.5</li>
<li>Ruby 2.1.2</li>
<li>Ruby 2.0.0</li>
<li>Ruby 1.9.3</li>
<li>JRuby</li>
</ul><p>== Installation</p>

<p>gem install attached</p>

<p>== Optional</p>

<p>brew install imagemagick
  brew install lame</p>

<p>== Examples</p>

<p>Migration:</p>

<p>rails g model video name:string encoding:attached</p>

<p>class CreateVideo &lt; ActiveRecord::Migration
    def self.up
      create_table :videos do |t|
        t.string :name
        t.attachment :encoding</p>

<pre><code>    t.timestamps
  end
end

def self.down
  drop_table :videos
end
</code></pre>

<p>end</p>

<p>Model:</p>

<p>class Video &lt; ActiveRecord::Base</p>

<pre><code>has_attached :encoding, styles: { 
  webm: { extension: '.webm' },
  mp4:  { extension: '.mp4'  },
  ogv:  { extension: '.ogv'  },
}

after_save do
  remote.encode(self.encoding.url)
end
</code></pre>

<p>end</p>

<p>Form:</p>

<p>&lt;%= form_for <a href="https://github.com/video" class="user-mention">@video</a>, html: { multipart: true } do |form| %&gt;
    &lt;%= form.file_field :encoding %&gt;
  &lt;% end %&gt;</p>

<p>View:</p>

<p>" /&gt;
  </p>

<p>== Advanced</p>

<p>=== Validations</p>

<p># app/models/person.rb
  validates_attached_presence :file
  validates_attached_size :file, in: 2.kilobytes..2.megabytes
  validates_attached_extension :file, in: %w(jpe jpg jpeg png)</p>

<p>==== Storage</p>

<p># app/models/user.rb
  has_attached :file, medium: :aws, credentials: "#{Rails.root}/config/aws.yml"</p>

<p># app/models/user.rb
  has_attached :file, medium: :google, credentials: "#{Rails.root}/config/google.yml"</p>

<p># app/models/user.rb
  has_attached :file, medium: :rackspace, credentials: "#{Rails.root}/config/rackspace.yml"</p>

<p># config/initializers/attached.rb
  Attached::Attachment.options[:medium] = :aws
  Attached::Attachment.options[:credentials] = "#{Rails.root}/config/aws.yml"</p>

<p># config/initializers/attached.rb
  Attached::Attachment.options[:medium] = :google
  Attached::Attachment.options[:credentials] = "#{Rails.root}/config/google.yml"</p>

<p># config/initializers/attached.rb
  Attached::Attachment.options[:medium] = :rackspace
  Attached::Attachment.options[:credentials] = "#{Rails.root}/config/rackspace.yml"</p>

<p>=== Processors</p>

<p># app/models/image.rb
  has_attached :file, processor: :image, styles: {
    small:   { size: '200x200&gt;', extension: '.jpg', quality: 90 },
    large:   { size: '400x400&lt;', extension: '.jpg', quality: 90 },
    default: { size: '300x300#', extension: '.jpg', quality: 90 },
  }</p>

<p># app/models/image.rb
  has_attached :file, processor: :image, styles: {
    small:   { operation: :decrease, width: 200, height: 200, extension: '.jpg', quality: 90 },
    large:   { operation: :increase, width: 400, height: 400, extension: '.jpg', quality: 90 },
    default: { operation: :resize,   width: 300, height: 300, extension: '.jpg', quality: 90 },
  }</p>

<p># app/models/audio.rb
  has_attached :file, processor: :audio, styles: {
    full:  { preset: '320kbps', extension: '.wav' },
    large: { preset: '256kbps', extension: '.wav' },
    small: { preset: '128kbps', extension: '.wav' },
  }</p>

<p># app/models/audio.rb
  has_attached :file, processor: :audio, styles: {
    full:  { preset: '320kbps', extension: '.wav' },
    large: { preset: '256kbps', extension: '.wav' },
    small: { preset: '128kbps', extension: '.wav' },
  }</p>

<p># app/models/audio.rb
  has_attached :file, processor: :audio, styles: {
    full:  { preset: 'insane',  extension: '.wav' },
    large: { preset: 'extreme', extension: '.wav' },
    small: { preset: 'medium',  extension: '.wav' },
  }</p>

<p>=== Strategies</p>

<p># app/models/sample.rb
  has_attached :file, processor: ..., styles: { ... }, strategy: :delay
  has_attached :file, processor: ..., styles: { ... }, strategy: :cache</p>

<p>=== Reprocessing</p>

<p>rake attached:process[Image,file]
  rake attached:process[Audio,file]</p>

<p>=== Aliases</p>

<p># app/initializer/attached.rb
  Attached::Attachment.options[:alias] = "<a href="https://storage.ksylvest.com/">https://storage.ksylvest.com/</a>"</p>

<p># app/initializer/attached.rb
  Attached::Attachment.options[:aliases] = %w(
    <a href="https://a.storage.ksylvest.com/">https://a.storage.ksylvest.com/</a>
    <a href="https://b.storage.ksylvest.com/">https://b.storage.ksylvest.com/</a>
    <a href="https://c.storage.ksylvest.com/">https://c.storage.ksylvest.com/</a>
    <a href="https://d.storage.ksylvest.com/">https://d.storage.ksylvest.com/</a>
  )</p>

<p>=== Metadata</p>

<p># app/initializers/attached.rb
  Attached::Attachment.options[:metadata] = { 'Cache-Control' =&gt; 'max-age=3153600' }</p>

<p>== Status</p>

<p>{<img src="http://img.shields.io/gemnasium/ksylvest/attached.svg">}[<a href="https://gemnasium.com/ksylvest/attached">https://gemnasium.com/ksylvest/attached</a>]
{<img src="http://img.shields.io/travis/ksylvest/attached.svg">}[<a href="https://travis-ci.org/ksylvest/attached">https://travis-ci.org/ksylvest/attached</a>]
{<img src="http://img.shields.io/codeclimate/github/ksylvest/attached.svg">}[<a href="https://codeclimate.com/github/ksylvest/attached">https://codeclimate.com/github/ksylvest/attached</a>]</p>

<p>== Copyright</p>

<p>Copyright (c) 2010 - 2013 Kevin Sylvestre. See LICENSE for details.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ksylvest">ksylvest</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-31911059-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>